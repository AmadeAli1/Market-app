create table usuario
(
    uid        uuid    default gen_random_uuid() not null
        primary key,
    username   varchar                           not null,
    password   varchar                           not null,
    email      varchar                           not null
        unique,
    address    varchar,
    postalcode varchar,
    imageurl   varchar,
    isopen     boolean default false
);

create table token
(
    uid         uuid    default gen_random_uuid() not null
        primary key,
    userid      uuid                              not null
        references usuario
            on update cascade on delete cascade,
    createdat   timestamp                         not null,
    expiredat   timestamp                         not null,
    confirmedat timestamp,
    isvalid     boolean default true
);

create table if not exists Category
(
    id            integer primary key generated ALWAYS AS IDENTITY,
    name          varchar(20) not null,
    imageUrl      varchar     not null,
    visualization integer     not null default 0,
    products      integer     not null default 0
);

create table if not exists product
(
    id          integer primary key generated always as identity,
    name        varchar(30)          not null,
    price       float8               not null,
    likes       integer              not null,
    avalible    boolean default true not null,
    createdat   timestamp            not null,
    description varchar              not null,
    category_fk integer              not null,
    constraint foreign_key_categoty
        foreign key (category_fk) references category (id)
            on update cascade on delete cascade,
    constraint pricevalue
        check (price > 0)
);

create table if not exists imageproduct
(
    product_fk integer not null references product (id) on update cascade on delete cascade,
    imageUrl   varchar not null
);

create table if not exists image
(
    id       integer primary key generated by default as identity,
    image    bytea   not null,
    filetype varchar not null,
    filename varchar not null
);

create table if not exists address
(
    id        integer primary key generated always AS IDENTITY,
    latitude  float8  not null,
    longitude float8  not null,
    name      varchar not null,
    userId    uuid    not null references usuario (uid) on DELETE CASCADE on UPDATE cascade
);

create table if not exists shoppingCart
(
    produto_fk int    not null references product (id) on delete cascade on update cascade,
    user_fk    uuid   not null references usuario (uid) on delete cascade on update cascade,
    quantity   int    not null check ( quantity > 0 ),
    unitPrice  float8 not null check ( unitPrice > 0 )
);